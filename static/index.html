<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI-Powered Intelligent Pack Design</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="topbar">
        <h1>
          <span class="title-ai-orb" aria-hidden="true"></span>
          <span>AI-Powered Intelligent Pack Design</span>
        </h1>
        <div class="top-actions">
          <div class="logo-slot" aria-label="Company logo">
            <img
              src="/static/images/logo.jpg"
              alt="Logo"
              onerror="this.style.visibility='hidden';"
            />
          </div>
          <button id="openKeyModalBtn" class="icon-btn" type="button" title="Manage API Key" aria-label="Manage API Key">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M14 4a6 6 0 1 0 4.24 10.24L22 18v2h-2v-2h-2v-2h-1.17A6 6 0 0 0 14 4zm0 2a4 4 0 1 1 0 8 4 4 0 0 1 0-8z"></path>
            </svg>
          </button>
          <span id="keyStateBadge" class="key-state">Key: Not Set</span>
          <div id="stepBadge" class="step-badge">Workflow Step: 1</div>
        </div>
      </header>

      <nav class="screen-tabs">
        <button id="tab1" class="tab active" type="button">1. Requirements & Baseline</button>
        <button id="tab2" class="tab" type="button">2. Edit Studio</button>
        <button id="tab3" class="tab" type="button">3. Approve & 3D</button>
        <button id="tab4" class="tab" type="button">4. Assets DB</button>
      </nav>

      <main>
        <section id="screen1" class="screen active">
          <div class="two-col">
            <div class="card">
              <h2>Requirements Refinement</h2>
              <details class="spec-panel" open>
                <summary>Design Spec</summary>
                <p id="specSummary">No specs collected yet.</p>
              </details>
              <div id="missingInfo" class="missing-info"></div>
              <div class="actions-row">
                <button id="indexAssetsBtn" class="btn secondary">Index Asset Metadata</button>
                <button id="uploadBriefBtn" class="btn secondary">Add Marketing Brief (PDF)</button>
                <input id="briefFileInput" type="file" accept="application/pdf" hidden />
                <button id="clearSessionBtn" class="btn secondary">Clear Session</button>
              </div>
            </div>
            <div class="card">
              <h2>Engineer Chat</h2>
              <div id="messages" class="messages"></div>
              <form id="chatForm" class="chat-input-row">
                <input id="chatInput" type="text" placeholder="Describe product type, volume, material, closure, style" required />
                <button class="btn" type="submit">Send</button>
              </form>
            </div>
          </div>
          <div class="card baseline-card">
            <h2>Baseline Decision</h2>
            <div class="actions-row baseline-actions-top">
              <button id="continueBaselineBtn" class="btn" type="button" hidden>Continue With Baseline</button>
              <button id="baselineSkipBtn" class="btn secondary" type="button" hidden>Continue Without Baseline</button>
            </div>
            <div id="baselineProgress" class="baseline-progress" hidden>
              <span id="baselineProgressFill"></span>
            </div>
            <p id="baselineStatus">Baseline decision pending.</p>
            <div id="baselineCandidates" class="list-grid"></div>
            <div id="baselineMatch" class="baseline-match" hidden>
              <strong>Selected Baseline</strong>
              <img id="baselinePreview" alt="Baseline asset" src="" />
              <p id="baselineSummary"></p>
            </div>
          </div>
        </section>

        <section id="screen2" class="screen">
          <div class="two-col">
            <div class="card">
              <h2>Edit Studio</h2>
              <div id="opProgress" class="op-progress" hidden>
                <div id="opProgressText" class="op-progress-text">Processing...</div>
                <div class="op-progress-bar"><span id="opProgressFill"></span></div>
              </div>
              <div class="preview-card">
                <img id="mainPreview" alt="Latest concept" src="" />
                <div id="previewPlaceholder" class="placeholder">No 2D concept yet</div>
              </div>
              <div class="actions-row">
                <button id="generate2dBtn" class="btn">Generate 2D Concept</button>
              </div>
              <div class="thumbs-card">
                <h3>Version History</h3>
                <div id="thumbs" class="thumb-grid"></div>
              </div>
            </div>
            <div class="card">
              <h2>Recommended Edits (<span id="recCount">0</span>)</h2>
              <div id="recList" class="rec-list"></div>
              <label for="manualEdit" class="label">Manual edit instruction</label>
              <textarea id="manualEdit" rows="4" placeholder="Example: make cap 10% taller and reduce body height by 5%"></textarea>
              <button id="applyManualBtn" class="btn">Run Edit</button>
            </div>
          </div>
        </section>

        <section id="screen3" class="screen">
          <div class="two-col">
            <div class="card">
              <h2>Approval</h2>
              <p id="approvalStatus">No version approved yet.</p>
              <img id="approvedImagePreview" class="candidate-thumb" alt="Approved version preview" src="" hidden />
              <div id="preview3dProgress" class="op-progress" hidden>
                <div id="preview3dProgressText" class="op-progress-text">Generating 3D preview...</div>
                <div class="op-progress-bar"><span></span></div>
              </div>
              <button id="generate3dPreviewBtn" class="btn warning">Generate 3D Preview (TripoSR)</button>
              <a id="open3dPreviewLink" class="btn secondary" href="#" target="_blank" rel="noopener" hidden>Open 3D File</a>
            </div>
            <div class="card">
              <h2>3D Preview Status</h2>
              <div id="threeDPanel" class="three-d">
                <p id="threeDText">Approve a version, then run TripoSR 2D->3D conversion.</p>
                <model-viewer
                  id="modelViewer"
                  src=""
                  camera-controls
                  auto-rotate
                  ar
                  style="width: 100%; height: 320px; display: none;"
                ></model-viewer>
              </div>
            </div>
          </div>
        </section>

        <section id="screen4" class="screen">
          <div class="card">
            <h2>Asset Database</h2>
            <div class="actions-row">
              <button id="refreshCatalogBtn" class="btn secondary">Refresh Catalog</button>
            </div>
            <div id="catalogCount" class="list-meta">Total assets: 0</div>
            <div id="assetCatalogList" class="catalog-grid"></div>
          </div>
        </section>

      </main>
    </div>

    <div id="keyModal" class="modal" hidden>
      <div class="modal-card">
        <h3>API Key</h3>
        <input id="apiKeyPopupInput" type="password" placeholder="Enter Straive API key" />
        <div class="actions-row">
          <button id="saveKeyPopupBtn" class="btn tiny" type="button">Save Key</button>
          <button id="clearKeyPopupBtn" class="btn tiny secondary" type="button">Clear</button>
          <button id="closeKeyModalBtn" class="btn tiny secondary" type="button">Close</button>
        </div>
      </div>
    </div>

    <script src="/static/app.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  </body>
</html>
